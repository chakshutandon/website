stages:
  - build
  - deploy

variables:
  HUGO_VERSION: 0.88.1

build:
  stage: build
  image: alpine:3.13.6
  script:
    - apk update && apk add curl
    - curl -L -o /tmp/hugo.tar.gz https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.tar.gz
    - mkdir /tmp/hugo; tar -xvf /tmp/hugo.tar.gz -C /tmp/hugo; mv /tmp/hugo/hugo /usr/local/bin/hugo
    - pwd; ls
  artifacts:
    paths: ['public']
    expire_in: 2 hrs

# staging:
#   stage: deploy
#   environment:
#     name: staging
#   only:
#     - master
#   image: node:alpine
#   dependencies:
#     - build
#   script:
#     - npm install -g firebase-tools
#     - firebase use staging --token $FIREBASE_DEPLOY_KEY
#     - firebase deploy -m "Pipeline $CI_PIPELINE_ID, Job $CI_JOB_ID" --non-interactive --token $FIREBASE_DEPLOY_KEY

# prod:
#   stage: deploy
#   environment:
#     name: prod
#   when: manual
#   only:
#     - master
#   image: node:alpine
#   dependencies:
#     - build
#   script:
#     - npm install -g firebase-tools
#     - firebase use production --token $FIREBASE_DEPLOY_KEY
#     - firebase deploy -m "Pipeline $CI_PIPELINE_ID, Job $CI_JOB_ID" --non-interactive --token $FIREBASE_DEPLOY_KEY
